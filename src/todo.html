<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="./lib/hamburgers.css" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="icon" href="./images/logo.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <title>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</title>
  </head>
  <body class="container">
    <script src="bundle.js"></script>
    <header class="header">
      <img src="./images/logo.svg" />
      <nav class="header__navigation">
        <ul id="navigation" class="header__navigation-list">
          <li class="header__navigation-list-item">
            <a href="./index.html">–ì–ª–∞–≤–Ω–∞—è</a>
          </li>
          <li class="header__navigation-list-item">
            <a href="./projects.html">–ü—Ä–æ–µ–∫—Ç—ã </a>
          </li>
          <li class="header__navigation-list-item">
            <a
              href="./todo.html"
              onclick="event.preventDefault()"
              class="active"
              >–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</a
            >
          </li>
          <li class="header__navigation-list-item">
            <a href="./about.html">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ </a>
          </li>
        </ul>
      </nav>
      <button id="theme-toggle" class="theme-toggle">üåô</button>
      <div id="hamburger" class="hamburger hamburger--collapse hide">
        <div class="hamburger-box">
          <div class="hamburger-inner"></div>
        </div>
      </div>
    </header>

    <main>
      <button onclick="window.addTaskDialog.showModal()">
        –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
      </button>
      <div id="tasks" class="todo">
        <div class="column" data-status="todo">
          <h2>–°–¥–µ–ª–∞—Ç—å</h2>
        </div>
        <div class="column" data-status="in-progress">
          <h2>–í —Ä–∞–±–æ—Ç–µ</h2>
        </div>
        <div class="column" data-status="done">
          <h2>–°–¥–µ–ª–∞–Ω–æ</h2>
        </div>
      </div>

      <dialog id="addTaskDialog" class="dialog">
        <div class="dialog-content">
          <span class="close-button" onclick="window.addTaskDialog.close()"
            >&times;</span
          >
          <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
          <input type="text" id="taskInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" />
          <menu>
            <button id="saveTaskButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button
              onclick="window.addTaskDialog.close()"
              id="cancel"
              type="reset"
            >
              –û—Ç–º–µ–Ω–∞
            </button>
          </menu>
        </div>
      </dialog>
    </main>

    <script>
      const themeToggle = document.getElementById("theme-toggle");
      const body = document.body;

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
      themeToggle.addEventListener("click", () => {
        body.classList.toggle("dark-theme");
        document
          .querySelectorAll(".card")
          .forEach((item) => item.classList.toggle("dark-theme"));
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞ –∫–Ω–æ–ø–∫–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
        if (body.classList.contains("dark-theme")) {
          themeToggle.textContent = "‚òÄÔ∏è"; // –ò–∫–æ–Ω–∫–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
        } else {
          themeToggle.textContent = "üåô"; // –ò–∫–æ–Ω–∫–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        }
      });

      // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ç–µ–º—É (–µ—Å–ª–∏ –µ—Å—Ç—å) –≤ localStorage
      window.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          body.classList.add("dark-theme");
          document
            .querySelectorAll(".card")
            .forEach((item) => item.classList.add("dark-theme"));
          themeToggle.textContent = "‚òÄÔ∏è"; // –ò–∫–æ–Ω–∫–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã
        } else {
          themeToggle.textContent = "üåô"; // –ò–∫–æ–Ω–∫–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
        }
      });

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É –≤ localStorage
      window.addEventListener("unload", () => {
        if (body.classList.contains("dark-theme")) {
          localStorage.setItem("theme", "dark");
        } else {
          localStorage.setItem("theme", "light");
        }
      });

      const dialog = document.getElementById("addTaskDialog");
      const taskInput = document.getElementById("taskInput");
      const saveTaskButton = document.getElementById("saveTaskButton");
      const columns = document.querySelectorAll(".column");
      const TASKS_KEY = "tasks";

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ localStorage
      function loadTasks() {
        const tasks = JSON.parse(localStorage.getItem(TASKS_KEY)) || [];
        columns.forEach((column) => {
          column.innerHTML = `<h2>${
            column.dataset.status === "todo"
              ? "–°–¥–µ–ª–∞—Ç—å"
              : column.dataset.status === "in-progress"
              ? "–í —Ä–∞–±–æ—Ç–µ"
              : "–°–¥–µ–ª–∞–Ω–æ"
          }</h2>`;
        });

        tasks.forEach((task, index) => {
          const column = document.querySelector(
            `.column[data-status="${task.status}"]`
          );
          if (!column) {
            console.error(`Column with status ${task.status} not found`);
            return;
          }

          const taskElement = document.createElement("div");
          taskElement.classList.add("card");
          if (body.classList.contains("dark-theme")) {
            taskElement.classList.add("dark-theme"); // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å dark-theme —Å—Ä–∞–∑—É
          }
          taskElement.draggable = true;
          taskElement.dataset.index = index;
          taskElement.dataset.status = task.status;
          taskElement.innerHTML = `
      ${task.name}
      <button onclick="deleteTask(${index})">–£–¥–∞–ª–∏—Ç—å</button>
    `;
          taskElement.addEventListener("dragstart", dragStart);
          taskElement.addEventListener("dragend", dragEnd);
          column.appendChild(taskElement);
        });
      }
      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
      saveTaskButton.addEventListener("click", () => {
        const taskName = taskInput.value.trim();

        if (taskName) {
          const tasks = JSON.parse(localStorage.getItem(TASKS_KEY)) || [];
          tasks.push({ name: taskName, status: "todo" });
          localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
          loadTasks();
          dialog.close();
        } else {
          alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –¥–∞—Ç—É!");
        }
      });

      // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
      function deleteTask(index) {
        const tasks = JSON.parse(localStorage.getItem(TASKS_KEY)) || [];
        tasks.splice(index, 1);
        localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
        loadTasks();
      }

      // Drag-and-Drop
      let draggedTask = null;

      function dragStart(event) {
        draggedTask = this;
        setTimeout(() => this.classList.add("invisible"), 0);
      }

      function dragEnd() {
        this.classList.remove("invisible");
        draggedTask = null;
      }

      columns.forEach((column) => {
        column.addEventListener("dragover", (event) => event.preventDefault());
        column.addEventListener("drop", function () {
          const tasks = JSON.parse(localStorage.getItem(TASKS_KEY)) || [];
          const taskIndex = draggedTask.dataset.index;
          tasks[taskIndex].status = this.dataset.status;
          localStorage.setItem(TASKS_KEY, JSON.stringify(tasks));
          loadTasks();
        });
      });

      // –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–¥–∞—á –≤ ICS

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      document.addEventListener("DOMContentLoaded", loadTasks);

      dialog.addEventListener("click", (event) => {
        if (event.target === dialog) {
          dialog.close();
        }
      });
    </script>
    <style>
      .invisible {
        opacity: 0;
      }
      .column {
        border: 1px dashed #ccc;
        padding: 10px;
        margin: 10px;
        min-height: 100px;
        flex: 1;
      }
      .todo {
        display: flex;
      }
    </style>
  </body>
</html>
